<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bybit Futures Trading Bot</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bybit-primary: #f7931a;
            --bybit-secondary: #2c3e50;
            --bybit-success: #27ae60;
            --bybit-danger: #e74c3c;
            --bybit-warning: #f39c12;
            --bybit-info: #3498db;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 14px; /* Reduced from default */
            line-height: 1.4; /* Professional line height */
        }
        
        /* Professional Typography Scale */
        h1 { font-size: 1.8rem; font-weight: 600; }
        h2 { font-size: 1.5rem; font-weight: 600; }
        h3 { font-size: 1.3rem; font-weight: 600; }
        h4 { font-size: 1.1rem; font-weight: 600; }
        h5 { font-size: 1.0rem; font-weight: 600; }
        h6 { font-size: 0.9rem; font-weight: 600; }
        
        /* Card and content typography */
        .card-body { font-size: 0.9rem; }
        .form-label { font-size: 0.85rem; font-weight: 500; }
        .form-control, .form-select { font-size: 0.85rem; }
        .btn { font-size: 0.85rem; font-weight: 500; }
        .badge { font-size: 0.75rem; }
        
        /* Metric values - keep prominent but professional */
        .metric-value {
            font-size: 1.5rem; /* Reduced from 2rem */
            font-weight: 600;
            color: var(--bybit-primary);
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 0.8rem; /* Reduced from 0.9rem */
            color: #bdc3c7;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }
        
        /* Price display - professional size */
        .price-display {
            font-size: 1.2rem; /* Reduced from 1.5rem */
            font-weight: 600;
            color: var(--bybit-primary);
        }
        
        /* Table typography */
        .table th { font-size: 0.85rem; font-weight: 600; }
        .table td { font-size: 0.8rem; }
        
        /* Navigation and buttons */
        .navbar-brand { font-size: 1.1rem; font-weight: 600; }
        .navbar-text { font-size: 0.85rem; }
        
        /* Status bar typography */
        .alert { font-size: 0.9rem; }
        .alert strong { font-size: 0.9rem; font-weight: 600; }
        
        /* Advanced Trading Panel specific */
        #advanced-trading-panel .card-body { font-size: 0.85rem; }
        #advanced-trading-panel .form-label { font-size: 0.8rem; }
        #advanced-trading-panel .form-control { font-size: 0.8rem; }
        #advanced-trading-panel .btn { font-size: 0.8rem; }
        
        /* Auto Trading Panel specific */
        #auto-trading-panel .card-body { font-size: 0.85rem; }
        #auto-trading-panel .form-label { font-size: 0.8rem; }
        #auto-trading-panel .form-control { font-size: 0.8rem; }
        #auto-trading-panel .btn { font-size: 0.8rem; }
        
        .navbar {
            background: linear-gradient(90deg, var(--bybit-primary) 0%, var(--bybit-secondary) 100%);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        
        .card-header {
            background: linear-gradient(45deg, var(--bybit-primary), var(--bybit-secondary));
            border-radius: 15px 15px 0 0 !important;
            border: none;
        }
        
        .futures-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .futures-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .futures-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
        }
        
        .change-positive {
            color: var(--bybit-success);
        }
        
        .change-negative {
            color: var(--bybit-danger);
        }
        
        .leverage-badge {
            background: linear-gradient(45deg, var(--bybit-warning), var(--bybit-primary));
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .risk-meter {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .risk-level {
            height: 100%;
            background: linear-gradient(90deg, var(--bybit-success), var(--bybit-warning), var(--bybit-danger));
            transition: width 0.3s ease;
        }
        
        .position-table {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .position-table th {
            background: var(--bybit-secondary);
            color: white;
            border: none;
            padding: 15px;
        }
        
        .position-table td {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: #bdc3c7;
        }
        
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid var(--bybit-primary);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Bot 2025 Specific Styles */
        .session-status {
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }
        
        .session-active {
            background: #27ae60;
            color: white;
        }
        
        .session-inactive {
            background: #e74c3c;
            color: white;
        }
        
        .session-disabled {
            background: #34495e;
            color: #bdc3c7;
        }
        
        .range-box-display {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        #bot2025-panel .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }
        
        #bot2025-panel .card-header {
            border-radius: 15px 15px 0 0 !important;
            border: none;
            color: white;
        }
        
        #bot2025-panel .form-control, #bot2025-panel .form-select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        #bot2025-panel .form-control:focus, #bot2025-panel .form-select:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: #3498db;
            color: white;
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
        }
        
        #bot2025-panel .form-control::placeholder {
            color: #bdc3c7;
        }
        
        #bot2025-panel .input-group-text {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #bdc3c7;
        }
        
        /* Modal Styling for Better Readability */
        .modal-content {
            background: #2c3e50 !important;
            color: #ffffff !important;
            border: 2px solid var(--bybit-primary);
            border-radius: 15px;
        }
        
        .modal-header {
            background: linear-gradient(45deg, var(--bybit-primary), var(--bybit-secondary)) !important;
            color: white !important;
            border-bottom: 2px solid var(--bybit-primary);
            border-radius: 13px 13px 0 0;
        }
        
        .modal-title {
            color: white !important;
            font-weight: bold;
        }
        
        .modal-body {
            background: #2c3e50 !important;
            color: #ffffff !important;
        }
        
        .modal-footer {
            background: #34495e !important;
            border-top: 2px solid var(--bybit-primary);
            border-radius: 0 0 13px 13px;
        }
        
        .form-label {
            color: #ffffff !important;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .form-control, .form-select {
            background: #34495e !important;
            border: 2px solid #5a6c7d !important;
            color: #ffffff !important;
            border-radius: 8px;
        }
        
        .form-control:focus, .form-select:focus {
            background: #34495e !important;
            border-color: var(--bybit-primary) !important;
            color: #ffffff !important;
            box-shadow: 0 0 0 0.2rem rgba(247, 147, 26, 0.25) !important;
        }
        
        .form-control::placeholder {
            color: #bdc3c7 !important;
        }
        
        .form-control-plaintext {
            background: #34495e !important;
            color: var(--bybit-primary) !important;
            font-weight: bold;
            font-size: 1.2rem;
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #5a6c7d;
        }
        
        .form-check-label {
            color: #ffffff !important;
            font-weight: 500;
        }
        
        .form-check-input:checked {
            background-color: var(--bybit-primary) !important;
            border-color: var(--bybit-primary) !important;
        }
        
        .btn-close {
            filter: invert(1) brightness(200%);
        }
        
        /* Button Styling */
        .modal .btn-secondary {
            background: #6c757d !important;
            border: 2px solid #6c757d !important;
            color: white !important;
            font-weight: bold;
        }
        
        .modal .btn-secondary:hover {
            background: #5a6268 !important;
            border-color: #5a6268 !important;
        }
        
        .modal .btn-bybit {
            background: linear-gradient(45deg, var(--bybit-primary), var(--bybit-secondary)) !important;
            border: 2px solid var(--bybit-primary) !important;
            color: white !important;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .modal .btn-bybit:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(247, 147, 26, 0.4);
        }
        
        /* Advanced Trading Panel Text Color Fixes */
        #advanced-trading-panel .card-body {
            color: #fafafa !important;
        }
        
        #advanced-trading-panel .form-label {
            color: #2c3e50 !important;
            font-weight: 600;
        }
        
        #advanced-trading-panel .form-control,
        #advanced-trading-panel .form-select {
            background: #ffffff !important;
            border: 1px solid #dee2e6 !important;
            color: #2c3e50 !important;
            font-weight: 500 !important;
        }
        
        #advanced-trading-panel .form-control:focus,
        #advanced-trading-panel .form-select:focus {
            color: #2c3e50 !important;
            background: #ffffff !important;
            border-color: var(--bybit-primary) !important;
            box-shadow: 0 0 0 0.2rem rgba(247, 147, 26, 0.25) !important;
        }
        
        #advanced-trading-panel .form-control::placeholder {
            color: #6c757d !important;
            font-weight: 400 !important;
        }
        
        #advanced-trading-panel .form-control:not(:placeholder-shown) {
            color: #2c3e50 !important;
            font-weight: 500 !important;
        }
        
        #advanced-trading-panel .form-control:focus:not(:placeholder-shown) {
            color: #2c3e50 !important;
            font-weight: 600 !important;
        }
        
        #advanced-trading-panel .input-group-text {
            background: #f8f9fa !important;
            border: 1px solid #dee2e6 !important;
            color: #495057 !important;
            font-weight: 500 !important;
        }
        
        #advanced-trading-panel .session-status {
            color: #ffffff !important;
            font-weight: 500;
        }
        
        #advanced-trading-panel .session-active {
            background: #28a745 !important;
            color: #ffffff !important;
        }
        
        #advanced-trading-panel .session-inactive {
            background: #dc3545 !important;
            color: #ffffff !important;
        }
        
        #advanced-trading-panel .session-disabled {
            background: #6c757d !important;
            color: #ffffff !important;
        }
        
        #advanced-trading-panel .badge {
            color: #ffffff !important;
        }
        
        #advanced-trading-panel .btn {
            color: #ffffff !important;
        }
        
        #advanced-trading-panel .btn-outline-primary {
            color: #007bff !important;
            border-color: #007bff !important;
        }
        
        #advanced-trading-panel .btn-outline-success {
            color: #28a745 !important;
            border-color: #28a745 !important;
        }
        
        #advanced-trading-panel .btn-outline-info {
            color: #17a2b8 !important;
            border-color: #17a2b8 !important;
        }
        
        #advanced-trading-panel .btn-outline-warning {
            color: #ffc107 !important;
            border-color: #ffc107 !important;
        }
        
        #advanced-trading-panel .btn-outline-danger {
            color: #dc3545 !important;
            border-color: #dc3545 !important;
        }
        
        /* Force all text to be visible in Advanced Trading Panel */
        #advanced-trading-panel h6,
        #advanced-trading-panel .form-label,
        #advanced-trading-panel .form-check-label,
        #advanced-trading-panel span:not(.badge),
        #advanced-trading-panel small {
            color: #f8f9f9 !important;
        }
        
        #advanced-trading-panel .card-body * {
            color: #f8f9f9;
        }
        
        #advanced-trading-panel .form-control,
        #advanced-trading-panel .form-select {
            color: #252a2f3b  !important;
        }
        
        #advanced-trading-panel .input-group-text {
            color: #edf5fd  !important;
            background-color: #252a2f3b !important;
        }
        
        /* Override Bootstrap defaults completely */
        #advanced-trading-panel .text-dark {
            color: #f6faff !important;
        }
        
        #advanced-trading-panel .text-muted {
            color: #edf5fd  !important;
        }
        
        #advanced-trading-panel .fw-bold {
            font-weight: 700 !important;
        }
        
        #advanced-trading-panel .fw-medium {
            font-weight: 500 !important;
        }
        
        /* Additional text color fixes for all elements */
        #advanced-trading-panel h6,
        #advanced-trading-panel .form-label,
        #advanced-trading-panel .form-check-label,
        #advanced-trading-panel label,
        #advanced-trading-panel span:not(.badge):not(.input-group-text),
        #advanced-trading-panel small,
        #advanced-trading-panel p {
            color: #ffffff !important;
            font-weight: 500 !important;
        }
        
        #advanced-trading-panel .input-group-text {
            color: #ffffff !important;
            background-color: #495057 !important;
            border-color: #6c757d !important;
        }
        
        #advanced-trading-panel .form-control,
        #advanced-trading-panel .form-select {
            color: #2c3e50 !important;
            background: #ffffff !important;
            border-color: #dee2e6 !important;
        }
        
        #advanced-trading-panel .form-control:focus,
        #advanced-trading-panel .form-select:focus {
            color: #2c3e50 !important;
            background: #ffffff !important;
            border-color: var(--bybit-primary) !important;
            box-shadow: 0 0 0 0.2rem rgba(247, 147, 26, 0.25) !important;
        }
        
        #advanced-trading-panel .form-check-label {
            color: #ffffff !important;
            font-weight: 500;
        }
        
        #advanced-trading-panel .text-muted {
            color: #bdc3c7 !important;
        }
        
        /* Auto Trading Panel specific */
        #auto-trading-panel .card-body { font-size: 0.85rem; }
        #auto-trading-panel .form-label { font-size: 0.8rem; }
        #auto-trading-panel .form-control { font-size: 0.8rem; }
        #auto-trading-panel .btn { font-size: 0.8rem; }
        
        .metric-card {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            margin-bottom: 15px;
        }
        
        .btn-bybit {
            background: linear-gradient(45deg, var(--bybit-primary), var(--bybit-secondary));
            border: none;
            border-radius: 25px;
            padding: 10px 25px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }
        
        .btn-bybit:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(247, 147, 26, 0.4);
        }
        
        /* Professional spacing and sizing */
        .card { padding: 1.25rem; }
        .card-header { padding: 1rem 1.25rem; }
        .card-body { padding: 1.25rem; }
        
        /* Form elements professional sizing */
        .form-control, .form-select {
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            min-height: 38px;
        }
        
        /* Button professional sizing */
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            min-height: 38px;
        }
        
        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.8rem;
            min-height: 32px;
        }
        
        /* Table professional sizing */
        .table th, .table td {
            padding: 0.75rem;
            vertical-align: middle;
        }
        
        /* Badge professional sizing */
        .badge {
            padding: 0.35rem 0.65rem;
            border-radius: 4px;
            font-weight: 500;
        }
        
        /* Modal professional sizing */
        .modal-header { padding: 1rem 1.25rem; }
        .modal-body { padding: 1.25rem; }
        .modal-footer { padding: 1rem 1.25rem; }
        
        /* Input group professional sizing */
        .input-group-text {
            padding: 0.5rem 0.75rem;
            font-size: 0.85rem;
            min-height: 38px;
        }
        
        /* Alert professional sizing */
        .alert {
            padding: 0.75rem 1rem;
            border-radius: 6px;
            border-width: 1px;
        }
        
        /* Professional shadows and borders */
        .card {
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        .btn {
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid transparent;
        }
        
        .btn:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-rocket me-2"></i>
                <strong>Bybit Futures Trading Interface</strong>
            </a>
            
            <div class="navbar-nav ms-auto">
                <button class="btn btn-outline-warning btn-sm me-3" onclick="openAdvancedTradingPanel()">
                    <i class="fas fa-robot me-1"></i>Advanced Trading
                </button>
                <button class="btn btn-outline-light btn-sm me-3" onclick="goBackToPionex()">
                    <i class="fas fa-arrow-left me-1"></i>Back to Pionex
                </button>
                <span class="navbar-text me-3">
                    <span class="status-indicator status-online me-2"></span>
                    <span>Bybit Connected</span>
                </span>
                <button class="btn btn-outline-light btn-sm me-2" onclick="manualRefresh()">
                    <i class="fas fa-sync-alt me-1"></i>Manual Refresh
                </button>
                <button class="btn btn-outline-light btn-sm" onclick="refreshData()">
                    <i class="fas fa-sync-alt me-1"></i>Auto Refresh
                </button>
            </div>
        </div>
    </nav>

    <!-- Status Bar - Show Current Trading Pair -->
    <div class="container-fluid mt-2">
        <div class="row">
            <div class="col-12">
                <div class="alert alert-info d-flex justify-content-between align-items-center" style="background: rgba(52, 152, 219, 0.2) !important; border: 2px solid #3498db !important; color: #ffffff !important;">
                    <div>
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Current Trading Pair:</strong>
                        <span id="status-bar-current-pair" class="badge bg-primary ms-2 fs-6">BTCUSDT</span>
                    </div>
                    <div>
                        <span class="me-3">
                            <i class="fas fa-robot me-1"></i>
                            <strong>Auto Trading:</strong>
                            <span id="status-bar-auto-trading" class="badge bg-danger ms-1">STOPPED</span>
                        </span>
                        <span>
                            <i class="fas fa-clock me-1"></i>
                            <strong>Status:</strong>
                            <span id="status-bar-status" class="badge bg-success ms-1">ACTIVE</span>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid mt-4">
        <!-- Header Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <div class="row align-items-center">
                            <div class="col">
                                <h4 class="mb-0">
                                    <i class="fas fa-chart-line me-2"></i>
                                    Bybit Futures Trading Dashboard
                                </h4>
                                <p class="mb-0 mt-2">Professional futures trading with advanced risk management</p>
                            </div>
                            <div class="col-auto">
                                <span class="badge bg-success fs-6">LIVE TRADING</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div class="row">
            <!-- Account Overview -->
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-wallet me-2"></i>Account Overview
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="metric-card">
                            <div class="metric-value" id="total-balance">$0.00</div>
                            <div class="metric-label">Total Balance</div>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <div class="metric-value text-success" id="available-balance">$0.00</div>
                                <div class="metric-label">Available</div>
                            </div>
                            <div class="col-6">
                                <div class="metric-value text-info" id="used-balance">$0.00</div>
                                <div class="metric-label">Used</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- P&L Summary -->
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-chart-area me-2"></i>P&L Summary
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="metric-card">
                            <div class="metric-value" id="total-pnl">$0.00</div>
                            <div class="metric-label">Total P&L</div>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <div class="metric-value text-success" id="realized-pnl">$0.00</div>
                                <div class="metric-label">Realized</div>
                            </div>
                            <div class="col-6">
                                <div class="metric-value text-warning" id="unrealized-pnl">$0.00</div>
                                <div class="metric-label">Unrealized</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Risk Management -->
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-shield-alt me-2"></i>Risk Management
                        </h6>
                    </div>
                    <div class="card-body text-center">
                        <div class="leverage-badge mb-3" id="current-leverage">10x</div>
                        <div class="risk-meter">
                            <div class="risk-level" id="risk-level" style="width: 30%;"></div>
                        </div>
                        <small class="text-muted">Risk Level: <span id="risk-text">Low</span></small>
                        <div class="mt-3">
                            <button class="btn btn-bybit btn-sm" onclick="adjustRisk()">
                                <i class="fas fa-sliders-h me-1"></i>Adjust Risk
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-bolt me-2"></i>Quick Actions
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label text-white">
                                <i class="fas fa-coins me-1"></i>Select Symbol
                            </label>
                            <select class="form-select form-select-sm" id="quick-symbol-select">
                                <option value="BTCUSDT">BTCUSDT</option>
                                <option value="ETHUSDT">ETHUSDT</option>
                                <option value="SOLUSDT">SOLUSDT</option>
                                <option value="ADAUSDT">ADAUSDT</option>
                                <option value="DOTUSDT">DOTUSDT</option>
                                <option value="BNBUSDT">BNBUSDT</option>
                            </select>
                        </div>
                        <div class="d-grid gap-2">
                            <button class="btn btn-bybit btn-sm" onclick="openQuickPosition()">
                                <i class="fas fa-plus me-1"></i>Open Position
                            </button>
                            <button class="btn btn-outline-danger btn-sm" onclick="closeAllPositions()">
                                <i class="fas fa-times me-1"></i>Close All
                            </button>
                            <button class="btn btn-outline-warning btn-sm" onclick="setGlobalStopLoss()">
                                <i class="fas fa-shield-alt me-1"></i>Set Stop Loss
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Futures Market Data -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-chart-bar me-2"></i>Futures Market Data
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="futures-grid" id="futures-market-data">
                            <!-- Market data cards will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Active Positions -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-list me-2"></i>Active Positions
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table position-table">
                                <thead>
                                    <tr>
                                        <th>Symbol</th>
                                        <th>Side</th>
                                        <th>Size</th>
                                        <th>Entry Price</th>
                                        <th>Mark Price</th>
                                        <th>Leverage</th>
                                        <th>P&L</th>
                                        <th>ROE %</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="positions-table">
                                    <tr>
                                        <td colspan="9" class="text-center">No active positions</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Advanced Trading System Panel (Hidden by default) -->
    <div id="advanced-trading-panel" class="container-fluid mt-4" style="display: none;">
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <div class="row align-items-center">
                            <div class="col">
                                <h4 class="mb-0" style="color: #ffffff !important; font-weight: bold;">
                                    <i class="fas fa-chart-line me-2"></i>
                                    Advanced Trading System
                                </h4>
                                <p class="mb-0 mt-2" style="color: #ffffff !important; font-weight: 500;">Professional algorithmic trading with advanced risk management</p>
                                
                                <!-- Current Trading Pair Display -->
                                <div class="mt-3 p-2" style="background: rgba(255, 255, 255, 0.2) !important; border-radius: 8px; display: inline-block;">
                                    <span style="color: #ffffff !important; font-weight: 600;">🎯 Active Pair: </span>
                                    <span id="advanced-panel-current-pair" class="badge bg-warning fs-6" style="color: #2c3e50 !important; font-weight: bold;">BTCUSDT</span>
                                </div>
                            </div>
                            <div class="col-auto">
                                <button class="btn btn-outline-light btn-sm" onclick="closeAdvancedTradingPanel()">
                                    <i class="fas fa-times me-1"></i>Close
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Trading Strategy Configuration -->
        <div class="row">
            <!-- Market Session Management -->
            <div class="col-lg-4 mb-4">
                <div class="card h-100">
                    <div class="card-header bg-info text-white">
                        <h6 class="mb-0" style="color: #ffffff !important; font-weight: bold;">
                            <i class="fas fa-clock me-2"></i>Session Management
                        </h6>
                    </div>
                    <div class="card-body" style="color: #ffffff !important;">
                        <!-- US Trading Session -->
                        <div class="mb-3">
                            <h6 style="color: #ffffff !important; font-weight: bold;">US Session (EST)</h6>
                            <div class="session-status" id="us-session-status" style="color: #ffffff !important; background: #28a745 !important; padding: 10px; border-radius: 10px; margin: 10px 0; text-align: center; font-weight: bold;">
                                <i class="fas fa-clock me-2"></i>Status: Active
                            </div>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="us-session-toggle" checked>
                                <label class="form-check-label" style="color: #ffffff !important; font-weight: 500;" for="us-session-toggle">Enable US Session</label>
                            </div>
                            <small style="color: #ffffff !important; font-weight: 500;">08:30-15:00 (Daylight)</small>
                        </div>
                        
                        <!-- Asian Trading Session -->
                        <div class="mb-3">
                            <h6 style="color: #ffffff !important; font-weight: bold;">Asian Session</h6>
                            <div class="session-status" id="asian-session-status" style="color: #ffffff !important; background: #28a745 !important; padding: 10px; border-radius: 10px; margin: 10px 0; text-align: center; font-weight: bold;">
                                <i class="fas fa-clock me-2"></i>Status: Active
                            </div>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="asian-session-toggle" checked>
                                <label class="form-check-label" style="color: #ffffff !important; font-weight: 500;" for="asian-session-toggle">Enable Asian Session</label>
                            </div>
                            <small style="color: #ffffff !important; font-weight: 500;">19:30-01:30 (UTC-5)</small>
                        </div>
                        
                        <button class="btn btn-info w-100" onclick="updateTradingSessions()" style="color: #ffffff !important; font-weight: bold;">
                            <i class="fas fa-save me-2"></i>Update Sessions
                        </button>
                    </div>
                </div>
            </div>

            <!-- Breakout Strategy Configuration -->
            <div class="col-lg-4 mb-4">
                <div class="card h-100">
                    <div class="card-header bg-success text-white">
                        <h6 class="mb-0" style="color: #ffffff !important; font-weight: bold;">
                            <i class="fas fa-chart-bar me-2"></i>Breakout Strategy
                        </h6>
                    </div>
                    <div class="card-body" style="color: #ffffff !important;">
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="breakout-toggle" checked>
                            <label class="form-check-label" style="color: #ffffff !important; font-weight: 500;" for="breakout-toggle">Enable Breakout Detection</label>
                        </div>
                        
                        <div class="row">
                            <div class="col-6">
                                <label class="form-label" style="color: #ffffff !important; font-weight: 500;">Buffer (%)</label>
                                <input type="number" class="form-control" id="buffer-percentage" value="0.05" step="0.01" min="0.01" max="1.0" style="color: #2c3e50 !important; background: #ffffff !important; font-weight: 500 !important;">
                            </div>
                            <div class="col-6">
                                <label class="form-label" style="color: #ffffff !important; font-weight: 500;">Confirmation</label>
                                <input type="number" class="form-control" id="confirmation-candles" value="1" min="1" max="5" style="color: #2c3e50 !important; background: #ffffff !important; font-weight: 500 !important;">
                            </div>
                        </div>
                        
                        <div class="row mt-2">
                            <div class="col-6">
                                <label class="form-label" style="color: #ffffff !important; font-weight: 500;">Max Trades</label>
                                <input type="number" class="form-control" id="max-trades-session" value="1" min="1" max="5" style="color: #2c3e50 !important; background: #ffffff !important; font-weight: 500 !important;">
                            </div>
                            <div class="col-6">
                                <label class="form-label" style="color: #ffffff !important; font-weight: 500;">Cooldown (min)</label>
                                <input type="number" class="form-control" id="cooldown-minutes" value="30" min="5" max="120" style="color: #2c3e50 !important; background: #ffffff !important; font-weight: 500 !important;">
                            </div>
                        </div>
                        
                        <button class="btn btn-success w-100 mt-3" onclick="updateBreakoutStrategy()" style="color: #ffffff !important; font-weight: bold;">
                            <i class="fas fa-save me-2"></i>Update Strategy
                        </button>
                    </div>
                </div>
            </div>

            <!-- Risk Management Configuration -->
            <div class="col-lg-4 mb-4">
                <div class="card h-100">
                    <div class="card-header bg-warning text-dark">
                        <h6 class="mb-0" style="color: #2c3e50 !important; font-weight: bold;">
                            <i class="fas fa-shield-alt me-2"></i>Risk Management
                        </h6>
                    </div>
                    <div class="card-body" style="color: #ffffff !important;">
                        <div class="row">
                            <div class="col-6">
                                <label class="form-label" style="color: #ffffff !important; font-weight: 500;">Stop Loss (%)</label>
                                <input type="number" class="form-control" id="stop-loss-percentage" value="1.5" step="0.1" min="0.5" max="10.0" style="color: #2c3e50 !important; background: #ffffff !important; font-weight: 500 !important;">
                            </div>
                            <div class="col-6">
                                <label class="form-label" style="color: #ffffff !important; font-weight: 500;">Take Profit (%)</label>
                                <input type="number" class="form-control" id="take-profit-percentage" value="2.5" step="0.1" min="1.0" max="20.0" style="color: #2c3e50 !important; background: #ffffff !important; font-weight: 500 !important;">
                            </div>
                        </div>
                        
                        <div class="form-check form-switch mt-3">
                            <input class="form-check-input" type="checkbox" id="use-box-opposite" checked>
                            <label class="form-check-label" style="color: #ffffff !important; font-weight: 500;" for="use-box-opposite">Use Box Opposite for SL</label>
                        </div>
                        
                        <div class="form-check form-switch mt-2">
                            <input class="form-check-input" type="checkbox" id="auto-breakeven" checked>
                            <label class="form-check-label" style="color: #ffffff !important; font-weight: 500;" for="auto-breakeven">Auto Breakeven at +1.0%</label>
                        </div>
                        
                        <button class="btn btn-warning w-100 mt-3" onclick="updateRiskManagement()" style="color: #2c3e50 !important; font-weight: bold;">
                            <i class="fas fa-save me-2"></i>Update Risk
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Technical Analysis & System Status -->
        <div class="row">
            <!-- Technical Analysis Filters -->
            <div class="col-lg-8 mb-4">
                <div class="card">
                    <div class="card-header bg-secondary text-white">
                        <h6 class="mb-0" style="color: #ffffff !important; font-weight: bold;">
                            <i class="fas fa-filter me-2"></i>Technical Analysis Filters
                        </h6>
                    </div>
                    <div class="card-body" style="color: #ffffff !important;">
                        <div class="row">
                            <!-- MTF RSI Filter -->
                            <div class="col-lg-6">
                                <h6 style="color: #ffffff !important; font-weight: bold;">Multi-Timeframe RSI</h6>
                                <div class="form-check form-switch mb-2">
                                    <input class="form-check-input" type="checkbox" id="mtf-rsi-toggle" checked>
                                    <label class="form-check-label" style="color: #ffffff !important; font-weight: 500;" for="mtf-rsi-toggle">Enable MTF RSI</label>
                                </div>
                                
                                <div class="mb-2">
                                    <label class="form-label" style="color: #ffffff !important; font-weight: 500;">5m Threshold</label>
                                    <div class="input-group">
                                        <span class="input-group-text" style="color: #ffffff !important; background: #495057 !important;">LONG <</span>
                                        <input type="number" class="form-control" id="rsi-5m-long" value="30" min="10" max="50" style="color: #2c3e50 !important; background: #ffffff !important; font-weight: 500 !important;">
                                    </div>
                                    <div class="input-group mt-1">
                                        <span class="input-group-text" style="color: #ffffff !important; background: #495057 !important;">SHORT ></span>
                                        <input type="number" class="form-control" id="rsi-5m-short" value="70" min="50" max="90" style="color: #2c3e50 !important; background: #ffffff !important; font-weight: 500 !important;">
                                    </div>
                                </div>
                                
                                <div class="mb-2">
                                    <label class="form-label" style="color: #ffffff !important; font-weight: 500;">1h Threshold</label>
                                    <div class="input-group">
                                        <span class="input-group-text" style="color: #ffffff !important; background: #495057 !important;">LONG <</span>
                                        <input type="number" class="form-control" id="rsi-1h-long" value="50" min="30" max="70" style="color: #2c3e50 !important; background: #ffffff !important; font-weight: 500 !important;">
                                    </div>
                                    <div class="input-group mt-1">
                                        <span class="input-group-text" style="color: #ffffff !important; background: #495057 !important;">SHORT ></span>
                                        <input type="number" class="form-control" id="rsi-1h-short" value="50" min="30" max="70" style="color: #2c3e50 !important; background: #ffffff !important; font-weight: 500 !important;">
                                    </div>
                                </div>
                                
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="reduced-version">
                                    <label class="form-check-label" style="color: #ffffff !important; font-weight: 500;" for="reduced-version">Reduced Version</label>
                                </div>
                            </div>
                            
                            <!-- Volume Filter -->
                            <div class="col-lg-6">
                                <h6 style="color: #ffffff !important; font-weight: bold;">Volume Analysis</h6>
                                <div class="form-check form-switch mb-2">
                                    <input class="form-check-input" type="checkbox" id="volume-filter-toggle" checked>
                                    <label class="form-check-label" style="color: #ffffff !important; font-weight: 500;" for="volume-filter-toggle">Enable Volume Filter</label>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label" style="color: #ffffff !important; font-weight: 500;">Volume Multiplier</label>
                                    <input type="number" class="form-control" id="volume-multiplier" value="1.5" step="0.1" min="1.0" max="5.0" style="color: #2c3e50 !important; background: #ffffff !important; font-weight: 500 !important;">
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label" style="color: #ffffff !important; font-weight: 500;">EMA Period</label>
                                    <input type="number" class="form-control" id="volume-ema-period" value="20" min="10" max="50" style="color: #2c3e50 !important; background: #ffffff !important; font-weight: 500 !important;">
                                </div>
                                
                                <button class="btn btn-secondary w-100" onclick="updateTechnicalFilters()" style="color: #ffffff !important; font-weight: bold;">
                                    <i class="fas fa-save me-2"></i>Update Filters
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Status & Control -->
            <div class="col-lg-4 mb-4">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h6 class="mb-0" style="color: #ffffff !important; font-weight: bold;">
                            <i class="fas fa-info-circle me-2"></i>System Status
                        </h6>
                    </div>
                    <div class="card-body" style="color: #ffffff !important;">
                        <div class="mb-3">
                            <h6 style="color: #ffffff !important; font-weight: bold;">Current Status</h6>
                            <div class="d-flex justify-content-between mb-2">
                                <span style="color: #ffffff !important; font-weight: 500;">System:</span>
                                <span class="badge bg-success">ACTIVE</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span style="color: #ffffff !important; font-weight: 500;">US Session:</span>
                                <span id="us-status-badge" class="badge bg-success">ACTIVE</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span style="color: #ffffff !important; font-weight: 500;">Asian Session:</span>
                                <span id="asian-status-badge" class="badge bg-success">ACTIVE</span>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <h6 style="color: #ffffff !important; font-weight: bold;">Quick Actions</h6>
                            <button class="btn btn-outline-primary btn-sm w-100 mb-2" onclick="refreshSystemStatus()" style="color: #007bff !important; font-weight: bold;">
                                <i class="fas fa-sync-alt me-1"></i>Refresh Status
                            </button>
                            <button class="btn btn-outline-success btn-sm w-100 mb-2" onclick="testBreakoutDetection()" style="color: #28a745 !important; font-weight: bold;">
                                <i class="fas fa-play me-1"></i>Test Detection
                            </button>
                            <button class="btn btn-outline-info btn-sm w-100" onclick="showSystemLogs()" style="color: #17a2b8 !important; font-weight: bold;">
                                <i class="fas fa-list me-1"></i>View Logs
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Range Analysis & Trading Control -->
        <div class="row">
            <!-- Range Box Analysis -->
            <div class="col-lg-8 mb-4">
                <div class="card">
                    <div class="card-header bg-dark text-white">
                        <h6 class="mb-0">
                            <i class="fas fa-cube me-2"></i>Range Box Analysis
                        </h6>
                    </div>
                    <div class="card-body">
                        <div id="range-boxes-display">
                            <!-- Range boxes will be populated here -->
                        </div>
                        
                        <div class="row mt-3">
                            <div class="col-6">
                                <button class="btn btn-dark w-100" onclick="calculateRangeBoxes()">
                                    <i class="fas fa-calculator me-2"></i>Calculate Boxes
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-outline-warning w-100" onclick="resetSessionTrades()">
                                    <i class="fas fa-redo me-2"></i>Reset Counters
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Trading Control Panel -->
            <div class="col-lg-4 mb-4">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h6 class="mb-0">
                            <i class="fas fa-gamepad me-2"></i>Trading Control
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <h6 style="color: #2c3e50 !important; font-weight: bold;">Position Control</h6>
                            <button class="btn btn-outline-success btn-sm w-100 mb-2" onclick="openQuickPosition()">
                                <i class="fas fa-plus me-1"></i>Open Position
                            </button>
                            <button class="btn btn-outline-danger btn-sm w-100 mb-2" onclick="closeAllPositions()">
                                <i class="fas fa-times me-1"></i>Close All
                            </button>
                        </div>
                        
                        <div class="mb-3">
                            <h6 style="color: #2c3e50 !important; font-weight: bold;">Risk Control</h6>
                            <button class="btn btn-outline-warning btn-sm w-100 mb-2" onclick="setGlobalStopLoss()">
                                <i class="fas fa-shield-alt me-1"></i>Set Stop Loss
                            </button>
                            <button class="btn btn-outline-info btn-sm w-100" onclick="adjustRisk()">
                                <i class="fas fa-sliders-h me-1"></i>Adjust Risk
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Auto Trading Control Panel -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-danger text-white">
                    <h6 class="mb-0" style="color: #ffffff !important; font-weight: bold;">
                        <i class="fas fa-robot me-2"></i>Auto Trading Control
                    </h6>
                </div>
                <div class="card-body" style="color: #ffffff !important;">
                    <div class="row">
                        <div class="col-lg-6">
                            <h6 style="color: #ffffff !important; font-weight: bold;">🤖 Auto Trading Status</h6>
                            <div class="d-flex justify-content-between mb-3">
                                <span style="color: #ffffff !important; font-weight: 500;">System Status:</span>
                                <span id="auto-trading-status" class="badge bg-danger">STOPPED</span>
                            </div>
                            <div class="d-flex justify-content-between mb-3">
                                <span style="color: #ffffff !important; font-weight: 500;">Active Strategies:</span>
                                <span id="active-strategies" class="badge bg-warning">0</span>
                            </div>
                            <div class="d-flex justify-content-between mb-3">
                                <span style="color: #ffffff !important; font-weight: 500;">Total Trades:</span>
                                <span id="total-trades" class="badge bg-info">0</span>
                            </div>
                            
                            <div class="d-grid gap-2">
                                <button class="btn btn-success w-100" onclick="startAutoTrading()" style="color: #ffffff !important; font-weight: bold;">
                                    <i class="fas fa-play me-2"></i>START Auto Trading
                                </button>
                                <button class="btn btn-danger w-100" onclick="stopAutoTrading()" style="color: #ffffff !important; font-weight: bold;">
                                    <i class="fas fa-stop me-2"></i>STOP Auto Trading
                                </button>
                            </div>
                        </div>
                        
                        <div class="col-lg-6">
                            <h6 style="color: #ffffff !important; font-weight: bold;">📊 Strategy Performance</h6>
                            
                            <!-- Current Trading Pair Display -->
                            <div class="mb-3 p-3" style="background: rgba(52, 152, 219, 0.2) !important; border: 2px solid #3498db !important; border-radius: 10px;">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span style="color: #ffffff !important; font-weight: 600;">🎯 Current Trading Pair:</span>
                                    <span id="current-trading-pair-display" class="badge bg-primary fs-6" style="color: #ffffff !important; font-weight: bold;">BTCUSDT</span>
                                </div>
                                <small style="color: #bdc3c7 !important; font-weight: 500;">This pair will be used for auto trading</small>
                            </div>
                            
                            <!-- Add Pair Selection -->
                            <div class="mb-3">
                                <label style="color: #ffffff !important; font-weight: 500;">Change Trading Pair:</label>
                                <select class="form-control mt-1" id="auto-trading-pair" onchange="updateCurrentPairDisplay()" style="color: #2c3e50 !important; background: #ffffff !important; font-weight: 500 !important;">
                                    <option value="BTCUSDT">BTCUSDT</option>
                                    <option value="ETHUSDT">ETHUSDT</option>
                                    <option value="SOLUSDT">SOLUSDT</option>
                                    <option value="ADAUSDT">ADAUSDT</option>
                                    <option value="DOTUSDT">DOTUSDT</option>
                                    <option value="BNBUSDT">BNBUSDT</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label style="color: #ffffff !important; font-weight: 500;">Max Daily Trades:</label>
                                <input type="number" class="form-control mt-1" id="max-daily-trades" value="5" min="1" max="20" style="color: #2c3e50 !important; background: #ffffff !important; font-weight: 500 !important;">
                            </div>
                            <div class="mb-3">
                                <label style="color: #ffffff !important; font-weight: 500;">Max Risk Per Trade (%):</label>
                                <input type="number" class="form-control mt-1" id="max-risk-per-trade" value="2.0" step="0.1" min="0.5" max="10.0" style="color: #2c3e50 !important; background: #ffffff !important; font-weight: 500 !important;">
                            </div>
                            <div class="mb-3">
                                <label style="color: #ffffff !important; font-weight: 500;">Daily Loss Limit (%):</label>
                                <input type="number" class="form-control mt-1" id="daily-loss-limit" value="5.0" step="0.1" min="1.0" max="20.0" style="color: #2c3e50 !important; background: #ffffff !important; font-weight: 500 !important;">
                            </div>
                            
                            <button class="btn btn-warning w-100" onclick="updateAutoTradingSettings()" style="color: #2c3e50 !important; font-weight: bold;">
                                <i class="fas fa-save me-2"></i>Update Settings
                            </button>
                        </div>
                    </div>
                    
                    <div class="row mt-4">
                        <div class="col-12">
                            <h6 style="color: #ffffff !important; font-weight: bold;">📈 How Auto Trading Works:</h6>
                            <div class="alert alert-info" style="background: rgba(23, 162, 184, 0.2) !important; border: 1px solid #17a2b8 !important; color: #ffffff !important;">
                                <strong>🔄 Breakout Strategy:</strong> System monitors price movements and automatically enters trades when breakout conditions are met.<br>
                                <strong>⏰ Session Management:</strong> Trades only during active US (8:30-15:00 EST) and Asian (19:30-01:30 UTC-5) sessions.<br>
                                <strong>🛡️ Risk Management:</strong> Automatic stop-loss, take-profit, and position sizing based on your risk parameters.<br>
                                <strong>📊 Technical Filters:</strong> Uses Multi-Timeframe RSI and Volume analysis to confirm trade signals.<br>
                                <strong>🎯 Anti-Fake Breakout:</strong> Waits for confirmation candles and volume validation before entering trades.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Bybit Interface JavaScript -->
    <script>
        // Debug: Check if functions are loaded
        console.log('Bybit Interface JavaScript loaded');
        
        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Bybit Interface DOM loaded');
            initializeBybitInterface();
            initializePairDisplay(); // Initialize pair display
            loadMarketData();
            loadPositions();
            loadAccountBalance(); // Load balance on page load
        });
        
        function initializeBybitInterface() {
            console.log('Initializing Bybit Interface');
            // Set up auto-refresh
            setInterval(refreshData, 30000); // Refresh every 30 seconds
        }
        
        function loadMarketData() {
            console.log('Loading real Bybit market data...');
            
            // Show loading state
            const container = document.getElementById('futures-market-data');
            container.innerHTML = '<div class="text-center"><div class="loading-spinner mx-auto"></div><p class="mt-2">Loading real market data...</p></div>';
            
            // Fetch real data from Bybit API
            fetch('/api/bybit/market-data')
                .then(response => response.json())
                .then(data => {
                    console.log('Real Bybit market data received:', data);
                    
                    if (data.success && data.data) {
                        displayRealMarketData(data.data);
                    } else {
                        console.error('Failed to load market data:', data.error);
                        // Fallback to mock data
                        loadMockMarketData();
                    }
                })
                .catch(error => {
                    console.error('Error fetching market data:', error);
                    // Fallback to mock data
                    loadMockMarketData();
                });
        }
        
        function displayRealMarketData(marketData) {
            const container = document.getElementById('futures-market-data');
            container.innerHTML = '';
            
            // Process real market data
            Object.keys(marketData).forEach(symbol => {
                const item = marketData[symbol];
                const card = createRealMarketDataCard(symbol, item);
                container.appendChild(card);
            });
        }
        
        function createRealMarketDataCard(symbol, data) {
            const card = document.createElement('div');
            card.className = 'futures-card';
            
            // Calculate 24h change percentage
            const prevPrice = parseFloat(data.prev_price) || 0;
            const currentPrice = parseFloat(data.price) || 0;
            const changePercent = prevPrice > 0 ? ((currentPrice - prevPrice) / prevPrice) * 100 : 0;
            
            // Format volume
            const volume = parseFloat(data.volume_24h) || 0;
            const volumeFormatted = volume > 1000000 ? (volume / 1000000).toFixed(1) + 'M' : 
                                  volume > 1000 ? (volume / 1000).toFixed(1) + 'K' : volume.toFixed(0);
            
            card.innerHTML = `
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h6 class="mb-0">${symbol}</h6>
                    <span class="badge bg-primary">FUTURES</span>
                </div>
                <div class="price-display mb-2">$${parseFloat(data.price).toLocaleString()}</div>
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="${changePercent >= 0 ? 'change-positive' : 'change-negative'}">
                        ${changePercent >= 0 ? '+' : ''}${changePercent.toFixed(2)}%
                    </span>
                    <span class="text-muted">Vol: ${volumeFormatted}</span>
                </div>
                <div class="d-flex justify-content-between align-items-center">
                    <span class="text-muted">Funding: ${(parseFloat(data.funding_rate) * 100).toFixed(4)}%</span>
                    <button class="btn btn-bybit btn-sm" onclick="openPosition('${symbol}')">
                        Trade
                    </button>
                </div>
                <div class="mt-2">
                    <small class="text-muted">
                        High: $${parseFloat(data.high_24h).toLocaleString()} | 
                        Low: $${parseFloat(data.low_24h).toLocaleString()}
                    </small>
                </div>
            `;
            return card;
        }
        
        function loadMockMarketData() {
            console.log('Loading mock market data as fallback');
            const marketData = [
                { symbol: 'BTCUSDT', price: 114368.28, change: 2.5, volume: '1.5B', funding: 0.01 },
                { symbol: 'ETHUSDT', price: 4230.39, change: -1.2, volume: '800M', funding: 0.02 },
                { symbol: 'SOLUSDT', price: 181.11, change: 5.8, volume: '200M', funding: 0.03 },
                { symbol: 'ADAUSDT', price: 0.8577, change: -8.87, volume: '700M', funding: -0.01 },
                { symbol: 'DOTUSDT', price: 3.796, change: -2.29, volume: '160M', funding: 0.004 },
                { symbol: 'BNBUSDT', price: 580.25, change: 1.5, volume: '900M', funding: 0.015 }
            ];
            
            const container = document.getElementById('futures-market-data');
            container.innerHTML = '';
            
            marketData.forEach(item => {
                const card = createMarketDataCard(item);
                container.appendChild(card);
            });
        }
        
        function loadPositions() {
            console.log('Loading real Bybit positions...');
            
            // Show loading state
            const tbody = document.getElementById('positions-table');
            tbody.innerHTML = '<tr><td colspan="9" class="text-center"><div class="loading-spinner mx-auto"></div><p class="mt-2">Loading positions...</p></td></tr>';
            
            // Fetch real positions from Bybit API
            fetch('/api/bybit/positions')
                .then(response => response.json())
                .then(data => {
                    console.log('Real Bybit positions received:', data);
                    
                    if (data.success && data.data) {
                        displayRealPositions(data.data);
                    } else {
                        console.error('Failed to load positions:', data.error);
                        // Show no positions
                        tbody.innerHTML = '<tr><td colspan="9" class="text-center">No active positions</td></tr>';
                    }
                })
                .catch(error => {
                    console.error('Error fetching positions:', error);
                    // Show no positions
                    tbody.innerHTML = '<tr><td colspan="9" class="text-center">No active positions</td></tr>';
                });
        }
        
        function displayRealPositions(positions) {
            const tbody = document.getElementById('positions-table');
            
            if (!positions || positions.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" class="text-center">No active positions</td></tr>';
                return;
            }
            
            tbody.innerHTML = positions.map(pos => `
                <tr>
                    <td><span class="badge bg-primary">${pos.symbol}</span></td>
                    <td><span class="badge bg-${pos.side === 'Buy' ? 'success' : 'danger'}">${pos.side}</span></td>
                    <td>${parseFloat(pos.size).toFixed(4)}</td>
                    <td>$${parseFloat(pos.avgPrice).toLocaleString()}</td>
                    <td>$${parseFloat(pos.markPrice).toLocaleString()}</td>
                    <td><span class="badge bg-warning">${pos.leverage}x</span></td>
                    <td class="${parseFloat(pos.unrealisedPnl) >= 0 ? 'text-success' : 'text-danger'} fw-bold">
                        ${parseFloat(pos.unrealisedPnl) >= 0 ? '+' : ''}$${parseFloat(pos.unrealisedPnl).toFixed(2)}
                    </td>
                    <td class="${parseFloat(pos.roe) >= 0 ? 'text-success' : 'text-danger'} fw-bold">
                        ${parseFloat(pos.roe) >= 0 ? '+' : ''}${parseFloat(pos.roe).toFixed(2)}%
                    </td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-warning btn-sm" onclick="editPosition('${pos.symbol}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-outline-danger btn-sm" onclick="closePosition('${pos.symbol}', '${pos.side}', ${pos.size})">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }
        
        function loadAccountBalance() {
            console.log('Loading real Bybit account balance...');
            
            // Fetch real balance from Bybit API
            fetch('/api/bybit/balance')
                .then(response => response.json())
                .then(data => {
                    console.log('Real Bybit balance received:', data);
                    
                    if (data.success && data.data) {
                        updateBalanceDisplay(data.data);
                    } else {
                        console.error('Failed to load balance:', data.error);
                        // Show error in UI
                        document.getElementById('total-balance').textContent = 'Error';
                        document.getElementById('available-balance').textContent = 'Error';
                        document.getElementById('used-balance').textContent = 'Error';
                    }
                })
                .catch(error => {
                    console.error('Error fetching balance:', error);
                    // Show error in UI
                    document.getElementById('total-balance').textContent = 'Error';
                    document.getElementById('available-balance').textContent = 'Error';
                    document.getElementById('used-balance').textContent = 'Error';
                });
        }
        
        function updateBalanceDisplay(balanceData) {
            console.log('Updating balance display with:', balanceData);
            
            // Update balance displays
            if (balanceData.list && balanceData.list.length > 0) {
                const account = balanceData.list[0]; // First account
                
                // Convert string values to float for formatting
                const totalEquity = parseFloat(account.totalEquity || 0);
                const totalWallet = parseFloat(account.totalWalletBalance || 0);
                const totalAvailable = parseFloat(account.totalAvailableBalance || 0);
                
                // Update main balance
                document.getElementById('total-balance').textContent = `$${totalEquity.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                
                // Update available balance
                document.getElementById('available-balance').textContent = `$${totalAvailable.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                
                // Update used balance (total wallet - available)
                const usedBalance = totalWallet - totalAvailable;
                document.getElementById('used-balance').textContent = `$${usedBalance.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                
                // Update P&L displays if available
                if (account.totalPerpUPL !== undefined) {
                    const totalPnl = parseFloat(account.totalPerpUPL || 0);
                    document.getElementById('total-pnl').textContent = `$${totalPnl.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                    
                    if (totalPnl >= 0) {
                        document.getElementById('total-pnl').className = 'metric-value text-success';
                    } else {
                        document.getElementById('total-pnl').className = 'metric-value text-danger';
                    }
                }
                
                // Update realized/unrealized P&L if available
                if (account.coin && account.coin.length > 0) {
                    const usdtCoin = account.coin.find(coin => coin.coin === 'USDT');
                    if (usdtCoin) {
                        const unrealizedPnl = parseFloat(usdtCoin.unrealisedPnl || 0);
                        const realizedPnl = parseFloat(usdtCoin.cumRealisedPnl || 0);
                        
                        document.getElementById('unrealized-pnl').textContent = `$${unrealizedPnl.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                        document.getElementById('realized-pnl').textContent = `$${realizedPnl.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                        
                        // Color code P&L
                        if (unrealizedPnl >= 0) {
                            document.getElementById('unrealized-pnl').className = 'metric-value text-success';
                        } else {
                            document.getElementById('unrealized-pnl').className = 'metric-value text-danger';
                        }
                        
                        if (realizedPnl >= 0) {
                            document.getElementById('realized-pnl').className = 'metric-value text-success';
                        } else {
                            document.getElementById('realized-pnl').className = 'metric-value text-danger';
                        }
                    }
                }
                
                console.log('Balance display updated successfully');
            } else {
                console.error('No account data found in balance response');
                // Show zero balances
                document.getElementById('total-balance').textContent = '$0.00';
                document.getElementById('available-balance').textContent = '$0.00';
                document.getElementById('used-balance').textContent = '$0.00';
            }
        }
        
        function openPosition(symbol) {
            console.log('Opening position for:', symbol);
            
            // Get current market price for the symbol
            fetch(`/api/bybit/ticker/${symbol}`)
                .then(response => response.json())
                .then(data => {
                    console.log('Ticker response:', data);
                    
                    if (data.success && data.data && data.data.list && data.data.list.length > 0) {
                        // Extract price from the correct field structure
                        const tickerData = data.data.list[0];
                        const currentPrice = parseFloat(tickerData.lastPrice || tickerData.markPrice || 0);
                        
                        console.log('Extracted price:', currentPrice, 'from ticker data:', tickerData);
                        
                        if (currentPrice && !isNaN(currentPrice) && currentPrice > 0) {
                            showPositionModal(symbol, currentPrice);
                        } else {
                            console.error('Invalid price extracted:', currentPrice);
                            alert(`Failed to get valid price for ${symbol}. Please try again.`);
                        }
                    } else {
                        console.error('Invalid ticker response structure:', data);
                        alert(`Failed to get price data for ${symbol}. Please try again.`);
                    }
                })
                .catch(error => {
                    console.error('Error getting price:', error);
                    alert(`Error getting price for ${symbol}. Please try again.`);
                });
        }
        
        function showPositionModal(symbol, currentPrice) {
            // Create a simple position modal
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.id = 'positionModal';
            
            // Format current price properly
            const formattedPrice = currentPrice && !isNaN(currentPrice) ? 
                currentPrice.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}) : 
                'Loading...';
            
            modal.innerHTML = `
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                <i class="fas fa-chart-line me-2"></i>
                                Open Position - ${symbol}
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-dollar-sign me-2"></i>Current Price
                                </label>
                                <div class="form-control-plaintext">
                                    $${formattedPrice}
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-arrows-alt-v me-2"></i>Position Side
                                </label>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="positionSide" id="long" value="Buy" checked>
                                    <label class="form-check-label text-success" for="long">
                                        <i class="fas fa-arrow-up me-1"></i>LONG (Buy)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="positionSide" id="short" value="Sell">
                                    <label class="form-check-label text-danger" for="short">
                                        <i class="fas fa-arrow-down me-1"></i>SHORT (Sell)
                                    </label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-coins me-2"></i>Position Size (USDT)
                                </label>
                                <input type="number" class="form-control" id="positionSize" step="0.01" placeholder="100.00" value="100.00">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-chart-line me-2"></i>Leverage
                                </label>
                                <select class="form-select" id="leverage">
                                    <option value="1">1x</option>
                                    <option value="2">2x</option>
                                    <option value="5">5x</option>
                                    <option value="10" selected>10x</option>
                                    <option value="20">20x</option>
                                    <option value="50">50x</option>
                                    <option value="100">100x</option>
                                </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                <i class="fas fa-times me-1"></i>Cancel
                            </button>
                            <button type="button" class="btn btn-bybit" onclick="executePosition('${symbol}')">
                                <i class="fas fa-play me-1"></i>Open Position
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            const bsModal = new bootstrap.Modal(modal);
            bsModal.show();
            
            // Remove modal from DOM when hidden
            modal.addEventListener('hidden.bs.modal', function() {
                document.body.removeChild(modal);
            });
        }
        
        function executePosition(symbol) {
            const side = document.querySelector('input[name="positionSide"]:checked').value;
            const size = parseFloat(document.getElementById('positionSize').value);
            const leverage = parseInt(document.getElementById('leverage').value);
            
            if (!size || size <= 0) {
                alert('Please enter a valid position size');
                return;
            }
            
            console.log('Executing position:', { symbol, side, size, leverage });
            
            // Execute the position via Bybit API
            fetch('/api/bybit/place-order', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    symbol: symbol,
                    side: side,
                    orderType: 'Market',
                    qty: size,
                    leverage: leverage
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(`Position opened successfully! Order ID: ${data.data.orderId}`);
                    // Close modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('positionModal'));
                    modal.hide();
                    // Refresh data
                    loadPositions();
                    loadAccountBalance();
                } else {
                    alert(`Failed to open position: ${data.error}`);
                }
            })
            .catch(error => {
                console.error('Error executing position:', error);
                alert('Error executing position. Please try again.');
            });
        }
        
        function editPosition(symbol) {
            console.log('Editing position for:', symbol);
            alert(`Editing position for ${symbol} - This would open the position edit modal`);
        }
        
        function closePosition(symbol, side, size) {
            console.log('Closing position:', { symbol, side, size });
            
            if (confirm(`Are you sure you want to close the ${symbol} ${side} position?`)) {
                // Close position via Bybit API
                fetch('/api/bybit/close-position', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        symbol: symbol,
                        side: side === 'Buy' ? 'Sell' : 'Buy', // Reverse side to close
                        qty: size
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert(`${symbol} position closed successfully!`);
                        loadPositions();
                        loadAccountBalance();
                    } else {
                        alert(`Failed to close position: ${data.error}`);
                    }
                })
                .catch(error => {
                    console.error('Error closing position:', error);
                    alert('Error closing position. Please try again.');
                });
            }
        }
        
        function closeAllPositions() {
            console.log('Closing all positions');
            
            if (confirm('Are you sure you want to close ALL positions?')) {
                // Close all positions via Bybit API
                fetch('/api/bybit/close-all-positions', {
                    method: 'POST'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('All positions closed successfully!');
                        loadPositions();
                        loadAccountBalance();
                    } else {
                        alert(`Failed to close all positions: ${data.error}`);
                    }
                })
                .catch(error => {
                    console.error('Error closing all positions:', error);
                    alert('Error closing all positions. Please try again.');
                });
            }
        }
        
        function setGlobalStopLoss() {
            console.log('Setting global stop loss');
            const stopLoss = prompt('Enter global stop loss percentage:', '5.0');
            if (stopLoss && !isNaN(stopLoss)) {
                // Set global stop loss via Bybit API
                fetch('/api/bybit/set-global-stop-loss', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        stopLossPercent: parseFloat(stopLoss)
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert(`Global stop loss set to ${stopLoss}%`);
                    } else {
                        alert(`Failed to set stop loss: ${data.error}`);
                    }
                })
                .catch(error => {
                    console.error('Error setting stop loss:', error);
                    alert('Error setting stop loss. Please try again.');
                });
            }
        }
        
        function adjustRisk() {
            console.log('Adjusting risk');
            const leverage = prompt('Enter new leverage (1-125):', '10');
            if (leverage && !isNaN(leverage)) {
                const newLeverage = parseInt(leverage);
                
                // Set leverage via Bybit API
                fetch('/api/bybit/set-leverage', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        leverage: newLeverage
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('current-leverage').textContent = newLeverage + 'x';
                        
                        // Update risk level based on leverage
                        const riskLevel = Math.min(newLeverage * 2, 100);
                        document.getElementById('risk-level').style.width = riskLevel + '%';
                        
                        let riskText = 'Low';
                        if (riskLevel > 50) riskText = 'High';
                        else if (riskLevel > 25) riskText = 'Medium';
                        
                        document.getElementById('risk-text').textContent = riskText;
                        
                        alert(`Leverage set to ${newLeverage}x, Risk Level: ${riskText}`);
                    } else {
                        alert(`Failed to set leverage: ${data.error}`);
                    }
                })
                .catch(error => {
                    console.error('Error setting leverage:', error);
                    alert('Error setting leverage. Please try again.');
                });
            }
        }
        
        function refreshData() {
            console.log('Refreshing all data from Bybit API');
            
            // Show loading state
            document.getElementById('total-balance').textContent = 'Loading...';
            document.getElementById('available-balance').textContent = 'Loading...';
            document.getElementById('used-balance').textContent = 'Loading...';
            
            // Refresh all data
            loadMarketData();
            loadPositions();
            loadAccountBalance();
            
            // Show success message
            setTimeout(() => {
                console.log('Data refresh completed');
            }, 1000);
        }
        
        // Add manual refresh button functionality
        function manualRefresh() {
            console.log('Manual refresh triggered');
            refreshData();
            
            // Show visual feedback
            const refreshBtn = document.querySelector('button[onclick="refreshData()"]');
            if (refreshBtn) {
                const originalText = refreshBtn.innerHTML;
                refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Refreshing...';
                refreshBtn.disabled = true;
                
                setTimeout(() => {
                    refreshBtn.innerHTML = originalText;
                    refreshBtn.disabled = false;
                }, 2000);
            }
        }

        function goBackToPionex() {
            console.log('Going back to Pionex interface');
            // Return to the main interface with Pionex selected
            window.location.href = '/pionex-interface';
        }

        function openBot2025Panel() {
            console.log('Opening Bot 2025 panel');
            document.getElementById('bot2025-panel').style.display = 'block';
            loadBot2025Status();
            loadRangeBoxes();
        }
        
        // Bot 2025 Panel Functions
        function closeBot2025Panel() {
            console.log('Closing Bot 2025 panel');
            document.getElementById('bot2025-panel').style.display = 'none';
        }
        
        function loadBot2025Status() {
            console.log('Loading Bot 2025 status...');
            
            // Simulate loading Bot 2025 status
            setTimeout(() => {
                updateSessionStatus();
                updateStatusBadges();
            }, 1000);
        }
        
        function updateSessionStatus() {
            // Update US session status
            const usStatus = document.getElementById('us-session-status');
            const usBadge = document.getElementById('us-status-badge');
            
            // Simulate session check (in real implementation, this would call the Bot 2025 API)
            const now = new Date();
            const hour = now.getHours();
            const minute = now.getMinutes();
            const currentTime = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
            
            // Check if US session is active (simplified logic)
            let usActive = false;
            if (hour >= 8 && hour < 16) {
                usActive = true;
            }
            
            if (usActive) {
                usStatus.className = 'session-status session-active';
                usStatus.innerHTML = '<i class="fas fa-clock me-2"></i>US Session: ACTIVE';
                usBadge.className = 'badge bg-success';
                usBadge.textContent = 'ACTIVE';
            } else {
                usStatus.className = 'session-status session-inactive';
                usStatus.innerHTML = '<i class="fas fa-clock me-2"></i>US Session: INACTIVE';
                usBadge.className = 'badge bg-danger';
                usBadge.textContent = 'INACTIVE';
            }
            
            // Update Asian session status
            const asianStatus = document.getElementById('asian-session-status');
            const asianBadge = document.getElementById('asian-status-badge');
            
            // Check if Asian session is active (19:30 - 01:30)
            let asianActive = false;
            if ((hour >= 19 && hour <= 23) || (hour >= 0 && hour <= 1)) {
                asianActive = true;
            }
            
            if (asianActive) {
                asianStatus.className = 'session-status session-active';
                asianStatus.innerHTML = '<i class="fas fa-clock me-2"></i>Asian Session: ACTIVE';
                asianBadge.className = 'badge bg-success';
                asianBadge.textContent = 'ACTIVE';
            } else {
                asianStatus.className = 'session-status session-inactive';
                asianStatus.innerHTML = '<i class="fas fa-clock me-2"></i>Asian Session: INACTIVE';
                asianBadge.className = 'badge bg-danger';
                asianBadge.textContent = 'INACTIVE';
            }
        }
        
        function updateStatusBadges() {
            // Update status badges based on current session status
            console.log('Updating status badges...');
        }
        
        function loadRangeBoxes() {
            console.log('Loading range boxes...');
            
            // Simulate range box data (in real implementation, this would call the Bot 2025 API)
            const mockRangeBoxes = {
                'BTCUSDT_us_session': {
                    symbol: 'BTCUSDT',
                    session: 'us_session',
                    high: 113850.0,
                    low: 112500.0,
                    range: 1350.0,
                    calculated_at: new Date().toISOString()
                },
                'ETHUSDT_asian_session': {
                    symbol: 'ETHUSDT',
                    session: 'asian_session',
                    high: 4250.0,
                    low: 4200.0,
                    range: 50.0,
                    calculated_at: new Date().toISOString()
                }
            };
            
            updateRangeBoxesDisplay(mockRangeBoxes);
        }
        
        function updateRangeBoxesDisplay(rangeBoxes) {
            const container = document.getElementById('range-boxes-display');
            container.innerHTML = '';
            
            if (!rangeBoxes || Object.keys(rangeBoxes).length === 0) {
                container.innerHTML = '<p class="text-muted">No range boxes calculated yet</p>';
                return;
            }
            
            Object.keys(rangeBoxes).forEach(key => {
                const box = rangeBoxes[key];
                const boxElement = document.createElement('div');
                boxElement.className = 'range-box-display';
                boxElement.innerHTML = `
                    <h6>${box.symbol} - ${box.session.replace('_', ' ').toUpperCase()}</h6>
                    <div class="row">
                        <div class="col-6">
                            <strong>High:</strong> $${box.high.toFixed(2)}<br>
                            <strong>Low:</strong> $${box.low.toFixed(2)}
                        </div>
                        <div class="col-6">
                            <strong>Range:</strong> $${box.range.toFixed(2)}<br>
                            <strong>Status:</strong> <span class="badge bg-info">CALCULATED</span>
                        </div>
                    </div>
                    <small class="text-muted">Calculated: ${new Date(box.calculated_at).toLocaleTimeString()}</small>
                `;
                container.appendChild(boxElement);
            });
        }
        
        function calculateAllRangeBoxes() {
            console.log('Calculating all range boxes...');
            
            // Show loading state
            const container = document.getElementById('range-boxes-display');
            container.innerHTML = '<div class="text-center"><div class="loading-spinner mx-auto"></div><p>Calculating range boxes...</p></div>';
            
            // Simulate calculation (in real implementation, this would call the Bot 2025 API)
            setTimeout(() => {
                loadRangeBoxes();
                alert('Range boxes calculated successfully!');
            }, 2000);
        }
        
        function resetSessionTrades() {
            if (confirm('Are you sure you want to reset all session trade counters? This will allow new trades in all sessions.')) {
                console.log('Resetting session trades...');
                
                // Simulate reset (in real implementation, this would call the Bot 2025 API)
                setTimeout(() => {
                    alert('Session trade counters reset successfully!');
                }, 1000);
            }
        }
        
        function updateTradingSessions() {
            console.log('Updating trading sessions...');
            
            const sessionData = {
                us_session: {
                    enabled: document.getElementById('us-session-toggle').checked
                },
                asian_session: {
                    enabled: document.getElementById('asian-session-toggle').checked
                }
            };
            
            // Simulate update (in real implementation, this would call the API)
            setTimeout(() => {
                alert('Session configuration updated successfully!');
                loadSystemStatus();
            }, 1000);
        }
        
        function updateBreakoutStrategy() {
            console.log('Updating breakout strategy settings...');
            
            const breakoutData = {
                enabled: document.getElementById('breakout-toggle').checked,
                buffer_percentage: parseFloat(document.getElementById('buffer-percentage').value),
                confirmation_candles: parseInt(document.getElementById('confirmation-candles').value),
                max_trades_per_session: parseInt(document.getElementById('max-trades-session').value),
                cooldown_minutes: parseInt(document.getElementById('cooldown-minutes').value)
            };
            
            // Simulate update (in real implementation, this would call the API)
            setTimeout(() => {
                alert('Breakout strategy parameters updated successfully!');
            }, 1000);
        }
        
        function updateRiskManagement() {
            console.log('Updating risk management settings...');
            
            const riskData = {
                stop_loss: {
                    percentage: parseFloat(document.getElementById('stop-loss-percentage').value),
                    use_box_opposite: document.getElementById('use-box-opposite').checked
                },
                take_profit: {
                    percentage: parseFloat(document.getElementById('take-profit-percentage').value)
                },
                auto_breakeven: {
                    enabled: document.getElementById('auto-breakeven').checked
                }
            };
            
            // Simulate update (in real implementation, this would call the API)
            setTimeout(() => {
                alert('Risk management parameters updated successfully!');
            }, 1000);
        }
        
        function updateTechnicalFilters() {
            console.log('Updating technical filter settings...');
            
            const filterData = {
                mtf_rsi: {
                    enabled: document.getElementById('mtf-rsi-toggle').checked,
                    thresholds: {
                        long_conditions: {
                            short_tf: parseInt(document.getElementById('rsi-5m-long').value),
                            long_tf: parseInt(document.getElementById('rsi-1h-long').value)
                        },
                        short_conditions: {
                            short_tf: parseInt(document.getElementById('rsi-5m-short').value),
                            long_tf: parseInt(document.getElementById('rsi-1h-short').value)
                        }
                    },
                    reduced_version: document.getElementById('reduced-version').checked
                },
                volume_filter: {
                    enabled: document.getElementById('volume-filter-toggle').checked,
                    multiplier: parseFloat(document.getElementById('volume-multiplier').value),
                    ema_period: parseInt(document.getElementById('volume-ema-period').value)
                }
            };
            
            // Simulate update (in real implementation, this would call the API)
            setTimeout(() => {
                alert('Technical filter settings updated successfully!');
            }, 1000);
        }
        
        function testBreakoutDetection() {
            console.log('Testing breakout detection...');
            
            // Simulate breakout detection test
            const testSymbol = 'BTCUSDT';
            const testPrice = 113900.0;
            
            // Show test results
            alert(`Breakout Detection Test:\nSymbol: ${testSymbol}\nPrice: $${testPrice}\nStatus: Testing breakout conditions...`);
            
            // Simulate test completion
            setTimeout(() => {
                alert('Breakout detection test completed!\nResult: No breakout detected at current price level.');
            }, 2000);
        }
        
        function showBot2025Logs() {
            console.log('Showing Bot 2025 logs...');
            
            // Simulate showing logs
            const logWindow = window.open('', '_blank', 'width=800,height=600');
            logWindow.document.write(`
                <html>
                <head><title>Bot 2025 Logs</title></head>
                <body style="font-family: monospace; padding: 20px; background: #1a1a2e; color: white;">
                    <h2>Bot 2025 Trading Logs</h2>
                    <div style="background: #2c3e50; padding: 15px; border-radius: 5px; margin: 10px 0;">
                        <strong>[2024-01-20 14:30:15]</strong> US Session started<br>
                        <strong>[2024-01-20 14:30:20]</strong> Range box calculated for BTCUSDT: High=$113,850, Low=$112,500<br>
                        <strong>[2024-01-20 14:35:10]</strong> No breakout detected - price within range<br>
                        <strong>[2024-01-20 14:40:05]</strong> Volume filter passed: 1.8x EMA20<br>
                        <strong>[2024-01-20 14:45:30]</strong> MTF RSI conditions met for LONG signal
                    </div>
                    <p>Logs are updated in real-time during trading sessions.</p>
                </body>
                </html>
            `);
        }
        
        // Debug: Log that all functions are defined
        console.log('All Bybit interface functions defined:', {
            initializeBybitInterface: typeof initializeBybitInterface,
            loadMarketData: typeof loadMarketData,
            displayRealMarketData: typeof displayRealMarketData,
            createRealMarketDataCard: typeof createRealMarketDataCard,
            loadMockMarketData: typeof loadMockMarketData,
            loadPositions: typeof loadPositions,
            displayRealPositions: typeof displayRealPositions,
            loadAccountBalance: typeof loadAccountBalance,
            updateBalanceDisplay: typeof updateBalanceDisplay,
            openPosition: typeof openPosition,
            openQuickPosition: typeof openQuickPosition,
            showPositionModal: typeof showPositionModal,
            executePosition: typeof executePosition,
            editPosition: typeof editPosition,
            closePosition: typeof closePosition,
            closeAllPositions: typeof closeAllPositions,
            setGlobalStopLoss: typeof setGlobalStopLoss,
            adjustRisk: typeof adjustRisk,
            refreshData: typeof refreshData,
            manualRefresh: typeof manualRefresh,
            goBackToPionex: typeof goBackToPionex,
            openBot2025Panel: typeof openBot2025Panel,
            closeBot2025Panel: typeof closeBot2025Panel,
            loadBot2025Status: typeof loadBot2025Status,
            updateSessionStatus: typeof updateSessionStatus,
            updateStatusBadges: typeof updateStatusBadges,
            loadRangeBoxes: typeof loadRangeBoxes,
            updateRangeBoxesDisplay: typeof updateRangeBoxesDisplay,
            calculateAllRangeBoxes: typeof calculateAllRangeBoxes,
            resetSessionTrades: typeof resetSessionTrades,
            updateTradingSessions: typeof updateTradingSessions,
            updateBreakoutStrategy: typeof updateBreakoutStrategy,
            updateRiskManagement: typeof updateRiskManagement,
            updateTechnicalFilters: typeof updateTechnicalFilters,
            testBreakoutDetection: typeof testBreakoutDetection,
            showBot2025Logs: typeof showBot2025Logs
        });

        function openQuickPosition() {
            const selectedSymbol = document.getElementById('quick-symbol-select').value;
            if (selectedSymbol) {
                openPosition(selectedSymbol);
            } else {
                alert('Please select a symbol first');
            }
        }

        function openAdvancedTradingPanel() {
            console.log('Opening Advanced Trading System panel');
            document.getElementById('advanced-trading-panel').style.display = 'block';
            loadSystemStatus();
            loadRangeBoxes();
        }
        
        // Advanced Trading System Panel Functions
        function closeAdvancedTradingPanel() {
            console.log('Closing Advanced Trading System panel');
            document.getElementById('advanced-trading-panel').style.display = 'none';
        }
        
        function loadSystemStatus() {
            console.log('Loading system status...');
            
            // Call API to get system status (visible in network tab)
            fetch('/api/bybit/auto-trading/status')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Update auto trading status
                        if (data.data.auto_trading_active) {
                            autoTradingActive = true;
                            document.getElementById('auto-trading-status').textContent = 'RUNNING';
                            document.getElementById('auto-trading-status').className = 'badge bg-success';
                        } else {
                            autoTradingActive = false;
                            document.getElementById('auto-trading-status').textContent = 'STOPPED';
                            document.getElementById('auto-trading-status').className = 'badge bg-danger';
                        }
                        
                        // Update counters
                        totalTrades = data.data.total_trades || 0;
                        activeStrategies = data.data.active_strategies || 0;
                        document.getElementById('total-trades').textContent = totalTrades;
                        document.getElementById('active-strategies').textContent = activeStrategies;
                        
                        // Update status bar
                        updateStatusBar();
                        
                        console.log('System status loaded:', data);
                    }
                })
                .catch(error => {
                    console.error('Error loading system status:', error);
                });
            
            // Simulate loading system status
            setTimeout(() => {
                updateSessionStatus();
                updateStatusBadges();
            }, 1000);
        }
        
        function refreshSystemStatus() {
            console.log('Refreshing system status...');
            loadSystemStatus();
        }
        
        function showSystemLogs() {
            console.log('Showing system logs...');
            
            // Simulate showing logs
            const logWindow = window.open('', '_blank', 'width=800,height=600');
            logWindow.document.write(`
                <html>
                <head><title>Advanced Trading System Logs</title></head>
                <body style="font-family: monospace; padding: 20px; background: #1a1a2e; color: white;">
                    <h2>Advanced Trading System Logs</h2>
                    <div style="background: #2c3e50; padding: 15px; border-radius: 5px; margin: 10px 0;">
                        <strong>[2024-01-20 14:30:15]</strong> US Trading Session started<br>
                        <strong>[2024-01-20 14:30:20]</strong> Range box calculated for BTCUSDT: High=$113,850, Low=$112,500<br>
                        <strong>[2024-01-20 14:35:10]</strong> No breakout detected - price within range<br>
                        <strong>[2024-01-20 14:40:05]</strong> Volume filter passed: 1.8x EMA20<br>
                        <strong>[2024-01-20 14:45:30]</strong> MTF RSI conditions met for LONG signal
                    </div>
                    <p>System logs are updated in real-time during trading sessions.</p>
                </body>
                </html>
            `);
        }
        
        function calculateRangeBoxes() {
            console.log('Calculating range boxes...');
            
            // Show loading state
            const container = document.getElementById('range-boxes-display');
            container.innerHTML = '<div class="text-center"><div class="loading-spinner mx-auto"></div><p>Calculating range boxes...</p></div>';
            
            // Simulate calculation (in real implementation, this would call the API)
            setTimeout(() => {
                loadRangeBoxes();
                alert('Range boxes calculated successfully!');
            }, 2000);
        }
        
        // Auto Trading Functions
        let autoTradingActive = false;
        let autoTradingInterval = null;
        let totalTrades = 0;
        let activeStrategies = 0;
        
        function startAutoTrading() {
            if (autoTradingActive) {
                alert('Auto trading is already running!');
                return;
            }
            
            console.log('Starting auto trading...');
            
            // Check if all required settings are configured
            const selectedPair = document.getElementById('auto-trading-pair').value;
            const maxDailyTrades = parseInt(document.getElementById('max-daily-trades').value);
            const maxRiskPerTrade = parseFloat(document.getElementById('max-risk-per-trade').value);
            const dailyLossLimit = parseFloat(document.getElementById('daily-loss-limit').value);
            
            if (!selectedPair || !maxDailyTrades || !maxRiskPerTrade || !dailyLossLimit) {
                alert('Please configure all auto trading settings first!');
                return;
            }
            
            // Show loading state
            document.getElementById('auto-trading-status').textContent = 'STARTING...';
            document.getElementById('auto-trading-status').className = 'badge bg-warning';
            
            // Get all Advanced Trading System settings
            const advancedSettings = {
                // Trading Pair
                trading_pair: selectedPair,
                
                // Auto Trading Settings
                max_daily_trades: maxDailyTrades,
                max_risk_per_trade: maxRiskPerTrade,
                daily_loss_limit: dailyLossLimit,
                
                // Session Management
                us_session_enabled: document.getElementById('us-session-toggle').checked,
                asian_session_enabled: document.getElementById('asian-session-toggle').checked,
                
                // Breakout Strategy
                breakout_enabled: document.getElementById('breakout-toggle').checked,
                buffer_percentage: parseFloat(document.getElementById('buffer-percentage').value),
                confirmation_candles: parseInt(document.getElementById('confirmation-candles').value),
                max_trades_per_session: parseInt(document.getElementById('max-trades-session').value),
                cooldown_minutes: parseInt(document.getElementById('cooldown-minutes').value),
                
                // Risk Management
                stop_loss_percentage: parseFloat(document.getElementById('stop-loss-percentage').value),
                take_profit_percentage: parseFloat(document.getElementById('take-profit-percentage').value),
                use_box_opposite: document.getElementById('use-box-opposite').checked,
                auto_breakeven: document.getElementById('auto-breakeven').checked,
                
                // Technical Filters
                mtf_rsi_enabled: document.getElementById('mtf-rsi-toggle').checked,
                rsi_5m_long: parseInt(document.getElementById('rsi-5m-long').value),
                rsi_5m_short: parseInt(document.getElementById('rsi-5m-short').value),
                rsi_1h_long: parseInt(document.getElementById('rsi-1h-long').value),
                rsi_1h_short: parseInt(document.getElementById('rsi-1h-short').value),
                reduced_version: document.getElementById('reduced-version').checked,
                
                // Volume Filter
                volume_filter_enabled: document.getElementById('volume-filter-toggle').checked,
                volume_multiplier: parseFloat(document.getElementById('volume-multiplier').value),
                volume_ema_period: parseInt(document.getElementById('volume-ema-period').value)
            };
            
            console.log('Advanced Trading System settings:', advancedSettings);
            
            // Call API to start auto trading (visible in network tab)
            fetch('/api/bybit/auto-trading/start', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(advancedSettings)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Start auto trading locally
                    autoTradingActive = true;
                    document.getElementById('auto-trading-status').textContent = 'RUNNING';
                    document.getElementById('auto-trading-status').className = 'badge bg-success';
                    
                    // Update pair display
                    document.getElementById('current-trading-pair-display').textContent = selectedPair;
                    document.getElementById('advanced-panel-current-pair').textContent = selectedPair;
                    document.getElementById('status-bar-current-pair').textContent = selectedPair;
                    
                    // Update status bar
                    updateStatusBar();
                    
                    // Start monitoring loop
                    autoTradingInterval = setInterval(() => {
                        if (autoTradingActive) {
                            monitorAndTrade();
                        }
                    }, 30000); // Check every 30 seconds
                    
                    // Show success message with all settings
                    alert(`✅ Auto Trading Started Successfully!\n\nTrading Pair: ${selectedPair}\n\nSystem will now:\n• Monitor ${selectedPair} market conditions\n• Execute trades automatically\n• Manage risk and positions\n• Follow session schedules\n\nSettings Applied:\n• Max Daily Trades: ${maxDailyTrades}\n• Risk Per Trade: ${maxRiskPerTrade}%\n• Daily Loss Limit: ${dailyLossLimit}%`);
                    
                    console.log('Auto trading started with settings:', advancedSettings);
                } else {
                    // Reset status on failure
                    document.getElementById('auto-trading-status').textContent = 'STOPPED';
                    document.getElementById('auto-trading-status').className = 'badge bg-danger';
                    alert(`❌ Failed to start auto trading: ${data.error}`);
                }
            })
            .catch(error => {
                console.error('Error starting auto trading:', error);
                // Reset status on error
                document.getElementById('auto-trading-status').textContent = 'STOPPED';
                document.getElementById('auto-trading-status').className = 'badge bg-danger';
                alert(`❌ Error starting auto trading: ${error.message}`);
            });
        }
        
        function stopAutoTrading() {
            if (!autoTradingActive) {
                alert('Auto trading is not running!');
                return;
            }
            
            console.log('Stopping auto trading...');
            
            // Show stopping state
            document.getElementById('auto-trading-status').textContent = 'STOPPING...';
            document.getElementById('auto-trading-status').className = 'badge bg-warning';
            
            // Call API to stop auto trading (visible in network tab)
            fetch('/api/bybit/auto-trading/stop', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    reason: 'user_requested',
                    total_trades_executed: totalTrades,
                    active_strategies: activeStrategies
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Stop auto trading locally
                    autoTradingActive = false;
                    document.getElementById('auto-trading-status').textContent = 'STOPPED';
                    document.getElementById('auto-trading-status').className = 'badge bg-danger';
                    
                    // Update status bar
                    updateStatusBar();
                    
                    // Clear monitoring interval
                    if (autoTradingInterval) {
                        clearInterval(autoTradingInterval);
                        autoTradingInterval = null;
                    }
                    
                    // Show success message
                    alert('🛑 Auto Trading Stopped Successfully!\n\nSystem has stopped:\n• No new trades will be executed\n• Existing positions remain active\n• Manual trading still available');
                    
                    console.log('Auto trading stopped');
                } else {
                    // Reset status on failure
                    document.getElementById('auto-trading-status').textContent = 'RUNNING';
                    document.getElementById('auto-trading-status').className = 'badge bg-success';
                    alert(`❌ Failed to stop auto trading: ${data.error}`);
                }
            })
            .catch(error => {
                console.error('Error stopping auto trading:', error);
                // Reset status on error
                document.getElementById('auto-trading-status').textContent = 'RUNNING';
                document.getElementById('auto-trading-status').className = 'badge bg-success';
                alert(`❌ Error stopping auto trading: ${error.message}`);
            });
        }
        
        function monitorAndTrade() {
            if (!autoTradingActive) return;
            
            console.log('Monitoring market conditions for auto trading...');
            
            // Check if we can trade (daily limits, session status)
            if (!canExecuteTrade()) {
                console.log('Trade conditions not met, skipping...');
                return;
            }
            
            // Get current market data
            fetch('/api/bybit/market-data')
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.data) {
                        analyzeMarketAndTrade(data.data);
                    }
                })
                .catch(error => {
                    console.error('Error monitoring market:', error);
                });
        }
        
        function canExecuteTrade() {
            // Check daily trade limit
            if (totalTrades >= parseInt(document.getElementById('max-daily-trades').value)) {
                console.log('Daily trade limit reached');
                return false;
            }
            
            // Check if any trading session is active
            const usSessionActive = document.getElementById('us-session-toggle').checked;
            const asianSessionActive = document.getElementById('asian-session-toggle').checked;
            
            if (!usSessionActive && !asianSessionActive) {
                console.log('No trading sessions active');
                return false;
            }
            
            // Check current time for session validation
            const now = new Date();
            const hour = now.getHours();
            const minute = now.getMinutes();
            
            let sessionActive = false;
            
            // US Session: 8:30-15:00 EST
            if (usSessionActive && hour >= 8 && hour < 16) {
                sessionActive = true;
            }
            
            // Asian Session: 19:30-01:30 UTC-5
            if (asianSessionActive && ((hour >= 19 && hour <= 23) || (hour >= 0 && hour <= 1))) {
                sessionActive = true;
            }
            
            if (!sessionActive) {
                console.log('No trading session currently active');
                return false;
            }
            
            return true;
        }
        
        function analyzeMarketAndTrade(marketData) {
            console.log('Analyzing market for trading opportunities...');
            
            // Analyze each symbol for breakout opportunities
            Object.keys(marketData).forEach(symbol => {
                const data = marketData[symbol];
                
                // Check breakout conditions
                if (checkBreakoutConditions(symbol, data)) {
                    console.log(`Breakout detected for ${symbol}, executing trade...`);
                    executeAutoTrade(symbol, data);
                }
            });
        }
        
        function checkBreakoutConditions(symbol, data) {
            // This is a simplified example - in real implementation, this would be more sophisticated
            const currentPrice = parseFloat(data.price);
            const prevPrice = parseFloat(data.prev_price);
            const changePercent = ((currentPrice - prevPrice) / prevPrice) * 100;
            
            // Check if price change exceeds threshold (simplified breakout detection)
            const breakoutThreshold = 0.5; // 0.5% change
            
            if (Math.abs(changePercent) > breakoutThreshold) {
                console.log(`${symbol}: Price change ${changePercent.toFixed(2)}% exceeds threshold ${breakoutThreshold}%`);
                return true;
            }
            
            return false;
        }
        
        function executeAutoTrade(symbol, data) {
            console.log(`Executing auto trade for ${symbol}...`);
            
            // Determine trade direction based on price movement
            const currentPrice = parseFloat(data.price);
            const prevPrice = parseFloat(data.prev_price);
            const side = currentPrice > prevPrice ? 'Buy' : 'Sell';
            
            // Calculate position size based on risk management
            const riskPercent = parseFloat(document.getElementById('max-risk-per-trade').value);
            const accountBalance = parseFloat(document.getElementById('total-balance').textContent.replace('$', '').replace(',', ''));
            const positionSize = (accountBalance * riskPercent / 100) / currentPrice;
            
            // Execute the trade via Bybit API
            fetch('/api/bybit/place-order', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    symbol: symbol,
                    side: side,
                    orderType: 'Market',
                    qty: positionSize.toFixed(4),
                    leverage: 10
                })
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    console.log(`Auto trade executed successfully for ${symbol}: ${side} ${positionSize.toFixed(4)}`);
                    
                    // Update counters
                    totalTrades++;
                    document.getElementById('total-trades').textContent = totalTrades;
                    
                    // Show success notification
                    showAutoTradingNotification(`✅ Auto Trade Executed!\n${symbol}: ${side} ${positionSize.toFixed(4)}\nPrice: $${currentPrice.toFixed(2)}`);
                } else {
                    console.error(`Failed to execute auto trade for ${symbol}:`, result.error);
                    showAutoTradingNotification(`❌ Auto Trade Failed!\n${symbol}: ${result.error}`);
                }
            })
            .catch(error => {
                console.error(`Error executing auto trade for ${symbol}:`, error);
                showAutoTradingNotification(`❌ Auto Trade Error!\n${symbol}: ${error.message}`);
            });
        }
        
        function showAutoTradingNotification(message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = 'alert alert-info position-fixed';
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                <div class="d-flex justify-content-between align-items-start">
                    <div>${message}</div>
                    <button type="button" class="btn-close" onclick="this.parentElement.parentElement.remove()"></button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Auto-remove after 10 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 10000);
        }
        
        function updateAutoTradingSettings() {
            const maxDailyTrades = document.getElementById('max-daily-trades').value;
            const maxRiskPerTrade = document.getElementById('max-risk-per-trade').value;
            const dailyLossLimit = document.getElementById('daily-loss-limit').value;
            
            console.log('Updating auto trading settings:', {
                maxDailyTrades,
                maxRiskPerTrade,
                dailyLossLimit
            });
            
            // Call API to update auto trading settings (visible in network tab)
            fetch('/api/bybit/auto-trading/settings', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    max_daily_trades: parseInt(maxDailyTrades),
                    max_risk_per_trade: parseFloat(maxRiskPerTrade),
                    daily_loss_limit: parseFloat(dailyLossLimit),
                    auto_trading_active: autoTradingActive
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Show success message
                    alert(`✅ Auto Trading Settings Updated!\n\nNew Settings:\n• Max Daily Trades: ${maxDailyTrades}\n• Max Risk Per Trade: ${maxRiskPerTrade}%\n• Daily Loss Limit: ${dailyLossLimit}%`);
                    
                    console.log('Auto trading settings updated successfully:', data);
                } else {
                    alert(`❌ Failed to update settings: ${data.error}`);
                }
            })
            .catch(error => {
                console.error('Error updating auto trading settings:', error);
                alert(`❌ Error updating settings: ${error.message}`);
            });
        }

        function updateCurrentPairDisplay() {
            const selectedPair = document.getElementById('auto-trading-pair').value;
            document.getElementById('current-trading-pair-display').textContent = selectedPair;
            document.getElementById('advanced-panel-current-pair').textContent = selectedPair;
            document.getElementById('status-bar-current-pair').textContent = selectedPair;
            
            // Show notification
            showAutoTradingNotification(`🎯 Trading Pair Changed to: ${selectedPair}`);
        }
        
        // Initialize pair display on page load
        function initializePairDisplay() {
            const selectedPair = document.getElementById('auto-trading-pair').value;
            document.getElementById('current-trading-pair-display').textContent = selectedPair;
            document.getElementById('advanced-panel-current-pair').textContent = selectedPair;
            document.getElementById('status-bar-current-pair').textContent = selectedPair;
        }
        
        // Update status bar
        function updateStatusBar() {
            const selectedPair = document.getElementById('auto-trading-pair').value;
            document.getElementById('status-bar-current-pair').textContent = selectedPair;
            
            if (autoTradingActive) {
                document.getElementById('status-bar-auto-trading').textContent = 'RUNNING';
                document.getElementById('status-bar-auto-trading').className = 'badge bg-success ms-1';
            } else {
                document.getElementById('status-bar-auto-trading').textContent = 'STOPPED';
                document.getElementById('status-bar-auto-trading').className = 'badge bg-danger ms-1';
            }
        }
    </script>
</body>
</html> 